<%
  date = locals.fetch(:date)
  my_commitment = locals.fetch(:my_commitment)
  commitments = locals.fetch(:commitments)
%>

<div class="panel panel-default day">

  <div class="panel-heading">
    <h2 class="panel-title"><%= date.strftime('%A, %-m/%-d/%y') %></h2>
  </div>

  <div class="panel-body">
    <% if commitments.present? %>
      <ul class="commitment-list">
        <% commitments.each do |commitment| %>
          <li>
            <span class="label label-<%= commitment.bootstrap_class_suffix %>"
                  ><%= commitment.display_text %></span>
            <%= link_to commitment.user.name, commitment.user %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="none">Nobody</p>
    <% end %>
  </div>

  <% if my_commitment %>
    <div class="panel-footer">
      <div class="actions">
        <div class="action" data-toggle="tooltip" data-placement="left"
             title="<%= 'Too late to cancel' if frozen?(date) %>"
             >
          <%= link_to commitment_path(my_commitment),
            method: :delete, class: 'btn btn-default', data: {
              disable_with: 'Taking you off the listâ€¦',
              confirm: "Do not #{uncapitalize my_commitment.display_verb} " \
                       "on #{my_commitment.date.strftime('%A, %-m/%-d/%y')}?"
            }, disabled: frozen?(date) do %>
            <% if frozen?(date) %>
              <span class="glyphicon glyphicon-lock"></span>
            <% end %>
            Take me off the list
          <% end %>
        </div>
      </div>
    </div>
  <% elsif can? :create, Commitment %>
    <div class="panel-footer">
      <div class="actions">
        <div class="action" data-toggle="tooltip" data-placement="left"
             title="<%= frozen?(date) ? 'Too late to sign up' :
                         'This date is out of season' if unavailable?(date) %>">
          <%= button_tag type: :button, class: 'btn btn-primary',
            data: { toggle: 'modal', target: '#commitmentCreationModal' },
            disabled: unavailable?(date) do %>
            <% if unavailable?(date) %>
              <span class="glyphicon glyphicon-lock"></span>
            <% end %>
            Sign up
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<%= render 'creation_modal', locals: { new_commitment: @new_commitment } if
  can? :create, Commitment %>
